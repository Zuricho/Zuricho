# DeepFRI

Model structure:

![image-20210816161853108](.\DeepFRI.assets\image-20210816161853108.png)

2 part: 

- Sequence embedding: LSTM
- Structure feature: GCN



## How to install

```bash
conda create DeepFRI python=3.7
conda install cudatoolkit=10.1 cudnn
pip install .
```





## How to use

Reference: [github page](https://github.com/flatironinstitute/DeepFRI)

### Option 1: predicting functions of a protein from its contact map

Example: predicting MF-GO terms for Parvalbumin alpha protein using its sequence and contact map (PDB: [1S3P](https://www.rcsb.org/structure/1S3P)):

输入是序列（不知道什么格式，应该在npz文件中）和Contact Map（在npz文件中）

这个方法的泛用性并不强，很多蛋白的Contact Map预测并不好

```bash
python predict.py --cmap ./examples/pdb_cmaps/1S3P-A.npz -ont mf --verbose
```

Output:

```
Protein GO-term/EC-number Score GO-term/EC-number name
query_prot GO:0005509 0.99824 calcium ion binding
```

### Option 2: predicting functions of a protein from its sequence

Example: predicting MF-GO terms for Parvalbumin alpha protein using its sequence (PDB: [1S3P](https://www.rcsb.org/structure/1S3P)):

单序列出发，准确性难以保证，结构预测部分的任务是由【未知】完成的

```
>> python predict.py --seq 'SMTDLLSAEDIKKAIGAFTAADSFDHKKFFQMVGLKKKSADDVKKVFHILDKDKDGFIDEDELGSILKGFSSDARDLSAKETKTLMAAGDKDGDGKIGVEEFSTLVAES' -ont mf --verbose
```

Output:

```
Protein GO-term/EC-number Score GO-term/EC-number name
query_prot GO:0005509 0.99769 calcium ion binding
```

### Option 3: predicting functions of proteins from a fasta file

跟上面差不多，不过这个是多个蛋白质

```
>> python predict.py --fasta_fn examples/pdb_chains.fasta -ont mf -v
```

Output:

```
Protein GO-term/EC-number Score GO-term/EC-number name
1S3P-A GO:0005509 0.99769 calcium ion binding
2J9H-A GO:0004364 0.46937 glutathione transferase activity
```

### Option 4: predicting functions of proteins from contact map catalogue

多个Contact Map的预测

```
>> python predict.py --cmap_csv examples/catalogue_pdb_chains.csv -ont mf -v
```

Output:

```
Protein GO-term/EC-number Score GO-term/EC-number name
1S3P-A GO:0005509 0.99824 calcium ion binding
2J9H-A GO:0004364 0.84826 glutathione transferase activity
```

### Option 5: predicting functions of a protein from a PDB file

预测一个结构对应的功能

```
python predict.py -pdb ./examples/pdb_files/1S3P-A.pdb -ont mf -v
```

Output:

```
Protein GO-term/EC-number Score GO-term/EC-number name
query_prot GO:0005509 0.99824 calcium ion binding
```

### Option 6: predicting functions of a protein from a directory with PDB files

预测一群蛋白结构的功能

```
python predict.py --pdb_dir ./examples/pdb_files -ont mf --saliency --use_backprop
```

Output:

See files in: `examples/outputs/`



# Functional residue identification

To visualize class activation (saliency) maps use `viz_gradCAM.py` script with the following options:

- `saliency_fn` str, JSON filename with saliency maps generated by `predict.py` script (see Option 6 above)
- `list_all` bool, list all proteins and their predicted GO terms with corresponding class activation (saliency) maps
- `protein_id` str, protein (PDB chain), saliency maps of which are to be visualized for each predicted function
- `go_id` str, GO term, saliency maps of which are to be visualized
- `go_name` str, GO name, saliency maps of which are to be visualized

Generated files:

- `saliency_fig_PDB-chain_GOterm.png` class activation (saliency) map profile over sequence (see fig below, right)
- `pymol_viz.py` pymol script for mapping salient residues onto 3D structure (pymol output is shown in fig below, left)

## Example:

```bash
python viz_gradCAM.py -i ./examples/outputs/DeepFRI_MF_saliency_maps.json -p 1S3P-A -go GO:0005509
```

### 





